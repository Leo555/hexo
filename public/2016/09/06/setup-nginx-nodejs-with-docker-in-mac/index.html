<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>在Mac上使用Docker配置nginx和node.js · PPxu is me</title><meta name="description" content="简单记录一下如何在 Mac 上使用 Docker，并配置 nginx 和 node.js 开发环境的操作步骤。

Mac 上推荐使用官方的安装包来安装 Docker，这是 下载地址，安装好后运行软件，在菜单栏上就可以看"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"></head><body><header><a href="/" class="logo-link"><img src="/ppxu.jpg"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">博客</a></li><li class="nav-list-item"><a href="http://weibo.com/ppxu" target="_blank" class="nav-list-link">微博</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li><li class="nav-list-item"><a href="https://github.com/ppxu" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">在Mac上使用Docker配置nginx和node.js</h1><div class="post-meta"><div class="post-time">2016年9月6日</div></div><div class="post-content"><p>简单记录一下如何在 Mac 上使用 Docker，并配置 nginx 和 node.js 开发环境的操作步骤。</p>
<a id="more"></a>
<p>Mac 上推荐使用官方的安装包来安装 <a href="https://www.docker.com/" target="_blank" rel="external">Docker</a>，这是 <a href="https://download.docker.com/mac/stable/Docker.dmg" target="_blank" rel="external">下载地址</a>，安装好后运行软件，在菜单栏上就可以看到一只萌萌的鲸鱼了。</p>
<p>我的目标是基于一个 Linux 镜像，安装 nginx 和 node.js，运行一个简单的 node.js 服务器。</p>
<p><a href="https://hub.docker.com/explore/" target="_blank" rel="external">Docker Hub</a> 上有很多官方和非官方的镜像，我选的是官方的 <a href="https://hub.docker.com/_/centos/" target="_blank" rel="external">centos</a>。</p>
<p>下面所有操作都是在命令行中执行。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">// 下载最新 centos 镜像</div><div class="line">$ docker pull centos:latest</div><div class="line"></div><div class="line">// 运行这个镜像，参数说明详见 [reference/commandline](https://docs.docker.com/engine/reference/commandline/)</div><div class="line">$ docker run -it --name web -p 8888:80 centos:latest</div></pre></td></tr></table></figure>
<p>然后命令行就会切换到容器系统的命令行中，下面就是安装 nginx 和 node.js 了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">// 更新包</div><div class="line">$ yum -y update</div><div class="line"></div><div class="line">// 安装 nginx</div><div class="line">$ wget http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm</div><div class="line">$ rpm -ivh nginx-release-centos-7-0.el7.ngx.noarch.rpm</div><div class="line">$ yum install nginx</div><div class="line"></div><div class="line">// 修改一下 nginx 配置，转发 node.js 端口</div><div class="line">$ vi /etc/nginx/conf.d/default.conf</div></pre></td></tr></table></figure>
<figure class="highlight tp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">server &#123;</div><div class="line">  listen       <span class="number">80</span>;</div><div class="line">  server_name  localhost;</div><div class="line"></div><div class="line">  location / &#123;</div><div class="line">    proxy_pass          http:<span class="comment">//127.0.0.1:3000/;</span></div><div class="line">    proxy_redirect      off;</div><div class="line">    proxy_set_header    <span class="keyword">X</span>-Real-IP       <span class="variable">$remote_addr</span>;</div><div class="line">    proxy_set_header    <span class="keyword">X</span>-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  ...</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// 启动 nginx</div><div class="line">$ nginx</div></pre></td></tr></table></figure>
<p>下面是手动编译安装 node.js</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">// 安装依赖</div><div class="line">$ yum -y install wget gcc make gcc-c++ openssl-devel</div><div class="line"></div><div class="line">// 下载最新 node.js</div><div class="line">$ wget https://nodejs.org/dist/v6.5.0/node-v6.5.0.tar.gz</div><div class="line"></div><div class="line">// 解压&amp;安装</div><div class="line">$ tar zxf node-v6.5.0.tar.gz</div><div class="line">$ <span class="built_in">cd</span> node-v6.5.0</div><div class="line">$ ./configure</div><div class="line">$ make &amp;&amp; make install</div></pre></td></tr></table></figure>
<p>node.js 安装好后写一个简单的 server.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</div><div class="line">  res.end(<span class="string">'Hello Docker!'</span>);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">server.listen(<span class="number">3000</span>);</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// 启动 server</div><div class="line">$ node server.js</div></pre></td></tr></table></figure>
<p>这样子整个流程就跑通了，在浏览器里面访问 <code>http://localhost:8888</code>，就可以看到</p>
<p><img src="http://7xpbfd.com1.z0.glb.clouddn.com/docker.png" alt="http://7xpbfd.com1.z0.glb.clouddn.com/docker.png"></p>
<p>接下来我们还可以把这个修改过的容器保存下来</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">// 退出容器系统</div><div class="line">$ <span class="built_in">exit</span></div><div class="line"></div><div class="line">// 查看容器信息</div><div class="line">$ docker ps <span class="_">-a</span></div><div class="line"></div><div class="line">// 将容器转化成镜像</div><div class="line">$ docker commit -m <span class="string">'add nginx &amp; node to centos'</span> <span class="_">-a</span> <span class="string">'ppxu'</span> web ppxu/cnn:v1</div><div class="line"></div><div class="line">// 查看所有的镜像</div><div class="line">$ docker images</div><div class="line"></div><div class="line">// 运行刚刚保存的镜像</div><div class="line">$ docker run -it -p 8888:80 ppxu/cnn:v1</div></pre></td></tr></table></figure>
<p>在这个容器中可以看到刚刚安装的 nginx 和 node.js 都正常运行。</p>
<p>最后我们可以把这个镜像上传到 Docker Hub 中，首先 <a href="https://hub.docker.com/" target="_blank" rel="external">注册帐号</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">// 用刚注册的帐号登录</div><div class="line">$ docker login</div><div class="line"></div><div class="line">// 上传镜像</div><div class="line">$ docker push ppxu/cnn:v1</div></pre></td></tr></table></figure>
<p>然后就可以在 <a href="https://hub.docker.com/" target="_blank" rel="external">Docker Hub</a> 上看到刚才上传的镜像了，其他人就可以直接使用这个镜像了。</p>
<h4 id="参考资料"><a class="header-anchor" href="#参考资料">¶</a>参考资料</h4>
<ul>
<li><a href="https://docs.docker.com/engine/getstarted/" target="_blank" rel="external">https://docs.docker.com/engine/getstarted/</a></li>
<li><a href="http://blog.saymagic.cn/2015/06/01/learning-docker.html#bqlkp" target="_blank" rel="external">http://blog.saymagic.cn/2015/06/01/learning-docker.html#bqlkp</a></li>
</ul>
</div></article></div></section><footer><div class="paginator"><a class="prev"> </a><a href="/2016/03/29/install-shadowsocks-service/" class="next">下一篇</a></div><div data-thread-key="2016/09/06/setup-nginx-nodejs-with-docker-in-mac/" data-title="在Mac上使用Docker配置nginx和node.js" data-url="https://ppxu.me/2016/09/06/setup-nginx-nodejs-with-docker-in-mac/" data-author-key="1" class="ds-thread"></div><script>var duoshuoQuery = {short_name:"ppxu"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
})();

</script><div class="powered"><p>Powered by<span>&nbsp;<a href="http://www.aliyun.com/" target="_blank">Aliyun</a></span><span>&nbsp;&&</span><span>&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a></span></p></div></footer><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src ="//hm.baidu.com/hm.js?3acd3117bffe31f23c04e3b8fec963fc";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></body></html>